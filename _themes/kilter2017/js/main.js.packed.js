window.Kilter={},Kilter.sendGA=function(s,t,e){typeof ga!="undefined"&&ga("send",{hitType:"event",eventCategory:s,eventAction:t,eventLabel:e})},Kilter.updateFontSize=function(s){var t=1,e=$(s).width(),n=parseInt($(s).css("max-height"),10),o=$(s).find("span");while(o.width()>e||o.height()>n)o.css("font-size",parseInt(o.css("font-size"),10)-t+"px")},Kilter.getElemWidth=function(s){var t=$(s).css("width"),e=$(s).css("margin-right"),n=parseInt(t,10)+2.5*parseInt(e,10);return n},Kilter.enableScroll=function(s,t,e){console.log("enableScroll",s),$(s).css("width",t*Kilter.getElemWidth(e)+"px"),$(s).mCustomScrollbar({axis:"x",theme:"dark-3",scrollInertia:10,alwaysShowScrollbar:0})},Kilter.parseJson=function(s,t,e){new Ractive({el:t,template:e,data:{content:s},oncomplete:function(){var s=t+" .click";$(s).click(function(){var s=$(this).data("target"),t=$(this).data("label");Kilter.sendGA("click",t,s)})}})},Kilter.parseProposalJson=function(s){var t=s.proposals.filter(function(s){return s.status==2});new Ractive({el:"#funnel-proposals",template:"#proposals-wrapper",data:{proposals:t},oncomplete:function(){$.each($(".proposal-card .title"),function(s,t){Kilter.updateFontSize(t)}),Kilter.enableScroll(".js-proposal-wrapper",t.length,".proposal-card"),$(window).resize(function(){Kilter.enableScroll(".js-proposal-wrapper",t.length,".proposal-card")}),$("#funnel-proposals .click, #funnel-proposals .btn").click(function(){var s=$(this).data("label"),t=$(this).data("target");Kilter.sendGA("click",s,t)})}})},Kilter.renderResponsiveTable=function(){$("td.tab-active").attr("colspan",3)},Kilter.disableResponsiveTable=function(){$("td").not(".centered").attr("colspan","")},Kilter.parseScheduleJson=function(s,t,e){var n=s.schedule,o=[],r=[],i=0,a=0,l=function(s){var t=parseInt(s.substr(0,4),10),e=parseInt(s.substr(5,2),10)-1,n=parseInt(s.substr(8,2),10),o=new Date;return o.setFullYear(t,e,n),o.toDateString()},c=function(s){return s.substr(s.indexOf("T")+1,5)},d=function(s){var t=s.substring(0,s.indexOf(":")),e=s.substring(s.indexOf(":")+1);return[t,e]},f=function(s,t){var e=new Date;return e.setHours(s),e.setMinutes(t),e},u=function(s){return(10>s.getHours()?"0":"")+s.getHours()+":"+((10>s.getMinutes()?"0":"")+s.getMinutes())},p=function(s){var t=parseInt(d(s)[0],10)+5,e=parseInt(d(s)[1],10)+30,n=f(t,e);return ist=u(n)},h=function(s){var t,e,n,o,r;t=d(s.start)[0],e=d(s.start)[1],n=f(t,e),t=d(s.end)[0],e=d(s.end)[1],o=f(t,e),s.slots=[];do r=u(n),s.slots.push({slot:r,issession:!1,sessions:[],occupied:"empty"}),n.setMinutes(n.getMinutes()+5);while(o>=n)},v=function(s){var t=parseInt(d(s)[0],10),e=parseInt(d(s)[1],10);return t*60+e},b=function(s){return s.substring(s.indexOf("/")+1).replace(/-/g," ")+", "+s.substring(0,s.indexOf("/")).replace(/-/g," ")},g=function(s){return s.substring(s.indexOf("/")+1).replace(/-/g," ")},m=function(s,t){var e;for(e=0;t.length>e;e++)if(t[e].name===s)return t[e].track},w=function(s,t){t.forEach(function(t){var e=t.sessions;e.forEach(function(t){var e=v(t.start);v(t.end),s.slots.forEach(function(s,n,o){v(s.slot)===e&&(o[n].sessions.push(t),o[n].issession=!0)})})})},k=function(s){s.slots.forEach(function(t,e,n){if(t.issession){(t.sessions[0].track===0||t.sessions[0].is_break)&&(t.occupied=0);var o=t.sessions;for(sessionindex=0;o.length>sessionindex;sessionindex++){var r=v(o[sessionindex].end),i=e+1,a=1,l=!1;for(i=e+1;n.length>i;i++){if(n[i].issession===!0&&v(n[i].sessions[0].start)>=r)break;n[i].issession===!0&&r>v(n[i].sessions[0].start)&&(l=!0,a+=1)}l&&(s.slots[e].sessions[sessionindex].rowspan=a)}}})},x=function(s){for(var t=0;s.slots.length>t;t++)if(s.slots[t].issession&&s.slots[t].occupied!==0){var e=!1;for(j=t-1;j>0;j--)s.slots[j].issession&&v(s.slots[j].sessions[0].end)>v(s.slots[t].sessions[0].start)&&(e=!0);if(e===!1){var n=parseInt(d(s.slots[t].sessions[0].start)[0],10),o=parseInt(d(s.slots[t].sessions[0].start)[1],10)+5,r=f(n,o),i=u(r);s.slots[t].sessions[1]=s.slots[t].sessions[0],s.slots[t].sessions[0]={track:"empty",start:s.slots[t].sessions[1].start,end:i}}}},K=function(s,t,e){s.forEach(function(s){var n=$("#scheduletemplate").html();t==="conference"?($(e).append(Mustache.render(n,s)),$(".schedule-table-container p.loadingtxt").hide()):($(e).append(Mustache.render(n,s)),$(".schedule-table-container p.loadingtxt").hide())}),768>$(window).width()&&Kilter.renderResponsiveTable()};n.forEach(function(s,t,e){var n=[];e[t].date=l(s.date),e[t].tableid="table-"+t,s.slots.forEach(function(s,o,r){var i=s.sessions;o===0&&(e[t].start=p(c(s.sessions[0].start))),o===r.length-1&&(e[t].end=p(c(s.sessions[i.length-1].end))),i.forEach(function(s,r){s.room&&n.indexOf(s.room)===-1&&n.push(s.room),e[t].slots[o].sessions[r].start=p(c(s.start)),e[t].slots[o].sessions[r].end=p(c(s.end))}),e[t].type!=="workshop"&&(e[t].type="conference")}),n.sort(),n.forEach(function(s,t,e){e[t]={name:s,title:b(s),shorttitle:g(s),track:t}}),e[t].rooms=n,s.slots.forEach(function(s,o){var r=s.sessions;r.forEach(function(s,r){s.room&&(e[t].slots[o].sessions[r].track=m(s.room,n),e[t].slots[o].sessions[r].roomTitle=b(s.room))})}),e[t].type==="conference"?(r.push({date:e[t].date,tableid:e[t].tableid,rooms:e[t].rooms,start:e[t].start,end:e[t].end}),h(r[i]),i+=1):(o.push({date:e[t].date,rooms:e[t].rooms,start:e[t].start,end:e[t].end}),h(o[a]),a+=1)}),i=0,a=0,n.forEach(function(s){s.slots.forEach(function(s){s.sessions.length>1&&s.sessions.sort(function(s,t){return s.track-t.track})}),s.type==="conference"?(w(r[i],s.slots),k(r[i]),x(r[i]),i+=1):(w(o[a],s.slots),k(o[a]),x(o[a]),a+=1)}),t==="conference"?K(r,"conference",e):K(o,"workshop",e)},$(document).ready(function(){if($("#nav-home").length)var s=$("#nav-home").offset().top;$(window).scroll(function(){$("#nav-home").length&&($(this).scrollTop()>s?$("#nav-home").addClass("navbar-fixed-top"):$("#nav-home").removeClass("navbar-fixed-top"))}),$(".smooth-scroll").click(function(s){s.preventDefault();var t=$(this).attr("href"),e=$(""+t).offset().top-$(".site-navbar").height();$("html,body").animate({scrollTop:e},"900")}),$(".button").click(function(){var s=$(this).html(),t=$(this).attr("href");Kilter.sendGA("click",s,t)}),$(".click").click(function(){var s=$(this).data("target"),t=$(this).data("label");Kilter.sendGA("click",t,s)}),$(window).resize(function(){768>$(window).width()?Kilter.renderResponsiveTable():Kilter.disableResponsiveTable()}),$("#conferenceschedule, #workshopschedule").on("click","table td .js-expand",function(){$(this).hasClass("fa-caret-right")?($(this).removeClass("fa-caret-right").addClass("fa-caret-down"),$(this).parents("td").find(".description-text").slideDown()):($(this).removeClass("fa-caret-down").addClass("fa-caret-right"),$(this).parents("td").find(".description-text").slideUp())}),$("#conferenceschedule, #workshopschedule").on("click","table th.track0, table th.track1, table th.track2",function(){if(768>$(window).width()){var s=$(this).parents("table"),t=$(this).attr("data-td");s.find(".tab-active").removeClass("tab-active"),$(this).addClass("tab-active"),s.find("."+t).addClass("tab-active"),Kilter.renderResponsiveTable()}})});